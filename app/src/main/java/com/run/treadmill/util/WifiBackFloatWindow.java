package com.run.treadmill.util;import android.app.Activity;import android.content.ComponentName;import android.content.Context;import android.content.Intent;import android.graphics.PixelFormat;import android.os.Build;import android.view.Gravity;import android.view.LayoutInflater;import android.view.View;import android.view.WindowManager;import android.widget.ImageView;import android.widget.LinearLayout;import com.run.treadmill.R;import com.run.treadmill.reboot.MyApplication;public class WifiBackFloatWindow implements View.OnClickListener {    private Context mContext;    private WindowManager mWindowManager;    private WindowManager.LayoutParams wmParams;    private LinearLayout mFloatWindow;    private ImageView btn_setting_back;    public WifiBackFloatWindow(Context context) {        mContext = MyApplication.getContext();        mWindowManager = (WindowManager) context.getSystemService(Context.WINDOW_SERVICE);    }    public WifiBackFloatWindow(Context context, Activity activity) {        mContext = context;        mWindowManager = (WindowManager) activity.getSystemService(Context.WINDOW_SERVICE);    }    public WifiBackFloatWindow(Context context, Activity activity, boolean isNoShowErr) {        mContext = context;        mWindowManager = (WindowManager) activity.getSystemService(Context.WINDOW_SERVICE);    }    private LinearLayout createFloatWindow(int w, int h) {        View view = LayoutInflater.from(mContext).inflate(R.layout.float_window_setting_back, null);        view.measure(View.MeasureSpec.makeMeasureSpec(0, View.MeasureSpec.UNSPECIFIED),                View.MeasureSpec.makeMeasureSpec(0, View.MeasureSpec.UNSPECIFIED));        LinearLayout mWindow = (LinearLayout) view;        wmParams = new WindowManager.LayoutParams();        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {            wmParams.type = WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY;        } else {            wmParams.type = WindowManager.LayoutParams.TYPE_PHONE;        }        wmParams.format = PixelFormat.RGBA_8888;        wmParams.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE | WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED;        wmParams.gravity = Gravity.END | Gravity.CENTER_HORIZONTAL;        wmParams.x = 0;        wmParams.y = 0;        wmParams.width = w;        wmParams.height = h;        wmParams.windowAnimations = android.R.style.Animation_Translucent;        return mWindow;    }    public void startFloat() {        mFloatWindow = createFloatWindow(mContext.getResources().getDimensionPixelSize(R.dimen.dp_px_110_x), mContext.getResources().getDimensionPixelSize(R.dimen.dp_px_85_y));        mWindowManager.addView(mFloatWindow, wmParams);        btn_setting_back = mFloatWindow.findViewById(R.id.btn_setting_back);        btn_setting_back.setOnClickListener(this);    }    public void stopFloat1() {        Logger.i("stopFloat1()");        // ThirdApkSupport.doStartApplicationWithPackageName(mContext, "top.cnzrg.otamcu", "top.cnzrg.otamcu.MainActivity");        ThirdApkSupport.killThirdApk(mContext, "com.android.settings");        ThirdApkSupport.killInputmethodPid(mContext, "com.google.android.inputmethod.pinyin");        if (mFloatWindow != null) {            mFloatWindow.setVisibility(View.GONE);            mWindowManager.removeView(mFloatWindow);            mFloatWindow = null;        }    }    public void stopFloat() {        Logger.i("stopFloat()");        // ThirdApkSupport.doStartApplicationWithPackageName(mContext, "top.cnzrg.otamcu", "top.cnzrg.otamcu.MainActivity");        // ThirdApkSupport.doStartApplicationWithPackageName(mContext, "com.run.treadmill", "com.run.treadmill.activity.home.HomeActivity");        ThirdApkSupport.killThirdApk(mContext, "com.android.settings");        ThirdApkSupport.killInputmethodPid(mContext, "com.google.android.inputmethod.pinyin");        if (mFloatWindow != null) {            mFloatWindow.setVisibility(View.GONE);            mWindowManager.removeView(mFloatWindow);            mFloatWindow = null;        }    }    @Override    public void onClick(View v) {        //回到Setting界面        stopFloat();    }    private static final String sys = "com.android.settings";    public static void enterSystemSetting2(final Context context, String className) {        Intent intent = new Intent(Intent.ACTION_MAIN);        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);        intent.addCategory(Intent.CATEGORY_LAUNCHER);        ComponentName cn = new ComponentName(sys, className);        intent.setComponent(cn);        context.startActivity(intent);    }}